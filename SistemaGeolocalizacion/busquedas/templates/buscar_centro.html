{% extends 'inicio.html' %}

{% block titulo %}
Búsqueda de Centros de Investigación
{% endblock titulo %}

{% block headers %}
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<style>
    #map{
        height: 546px;
    }

    html,
    body {
        height: 100%;
    }
</style>

{% endblock headers %}

{% block contenido %}

<div class="container-fluid">
    <h1 class="text-center">Mapa de los Centros de Investigación en el Estado de Zacatecas</h1>
    <h4 class="text-center">Buscamos resolver problemas de gente zacatecana con investigadores e instituciones zacatecanas.</h4>
    <nav class="navbar navbar-light bg-light">
        <form method="get">
            <div id="custom-search-input">
                <div class="input-group col-md-12">
                    <input type="text" class="form-control" placeholder="Buscar..." name="buscar"
                           value="{{ request.GET.buscar }}">
                    <span class="input-group list">
                        <i class="icon icon-search"></i>
                        <button type="submit" class="boton btn-success">Buscar</button>
                    </span>
                </div>
            </div>
        </form>
    </nav>
    <p>
        <label>Filtros de búsqueda
            <select id=''>
                <option value=''>Selecciona una opción</option>
                <option value='nombre'>Nombre del Centro de Investigación</option>
                <option value='enfoque'>Área de especialización</option>
                <option value='estado'>Estado</option>
            </select>
        </label>
    </p>

    <div class="row">
        <div id = "map"></div>
    </div>

    <h4 class="text-center">Datos del Centro de Investigacion</h4>

    <div class="row text-center">
        <div class="col-4 box1 pt-4">
                <i class="fas fa-phone fa-3x"></i>
                <h3 class="d-none d-lg-block d-xl-block">Teléfono</h3>
                <p class="d-none d-lg-block d-xl-block">
                    {% for centro in centros %}
                    <tr>
                        <td><b>{{ centro.telefono }}</b></td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2">
                        <p>No existen datos</p>
                        </td>
                    </tr>
                    {% endfor %}
                </p>
            </a>
        </div>
        <div class="col-4 box2 pt-4" >
                <i class="fas fa-home fa-3x"></i>
                <h3 class="d-none d-lg-block d-xl-block">Dirección</h3>
                <p class="d-none d-lg-block d-xl-block">
                    {% for centro in centros %}
                    <tr>
                        <td >
                            <a onclick="return crearRuta();"
                                type="button" class="btn btn-link fas fa-car"
                                href="https://www.google.com.mx/maps/preview" target="_blank" id="direccion">{{ centro.latitud }}, {{ centro.longitud }}
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2">
                        <p>No existen datos</p>
                        </td>
                    </tr>
                    {% endfor %}
                </p>
            </a>
        </div>
        <div class="col-4 box3 pt-4">
                <i class="fas fa-envelope fa-3x"></i>
                <h3 class="d-none d-lg-block d-xl-block">Datos</h3>
                <p class="d-none d-lg-block d-xl-block">
                    {% for centro in centros %}
                    <tr>
                        <td><b>{{ centro.nombreEncargado }}</b></td>
                        <td><b>{{ centro.telefonoEncargado }}</b></td>
                        <td><b>{{ centro.correoEncargado }}</b></td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2">
                        <p>No existen datos</p>
                        </td>
                    </tr>
                    {% endfor %}
                </p>
            </a>
        </div>
    </div>
</div>

{% endblock contenido %}

{% block scripts %}
<script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjSQ168Tk_ohpBsiDZmVVbXp5jj7-DYrw&callback=initMap&v=weekly"
        async
></script>
<script>

    let marker;
    function initMap() {
        var infoWindow = new google.maps.InfoWindow();
        const map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 22.766050981989335, lng: -102.5697492675781 },
            zoom: 10,
        });

        {% for centro in centros %}
            marker = new google.maps.Marker({
                map,
                position: { lat: parseFloat({{ centro.latitud }}), lng: parseFloat({{ centro.longitud }}) },
            });

            google.maps.event.addListener(marker, 'click', (function(marker){
                return function() {
                    infoWindow.setContent("{{centro.nombre}}, {{centro.latitud}}, {{centro.longitud}}");
                    infoWindow.open(map, marker);
                }
            })(marker))

        {% endfor %}
    }

    function crearRuta() {
        var item = document.getElementById('direccion').textContent;
        alert(item);
        if (item) {
            window.open('https://google.com.mx/maps/place/' + item, '_blank');
        }
        return false;
    }

    window.initMap = initMap;

</script>
{% endblock scripts %}